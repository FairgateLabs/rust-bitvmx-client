x-logging:
  &default-logging
  options:
    max-size: '12m'
    max-file: '5'
  driver: json-file

services:
  bitcoind:
    container_name: bitcoind
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile
      args:
        BITCOIND_RPC_PORT: 18443
        BITCOIND_RPC_USERNAME: foo
        BITCOIND_RPC_PASSWORD: rpcpassword
        BITCOIND_RPC_NETWORK: regtest
    logging: *default-logging
    ports:
      - "18443:18443"
    healthcheck:
      test: ["CMD", "wget", "--user", "foo", "--password", "rpcpassword", "--post-data", '{"jsonrpc": "1.0", "id": "healthcheck", "method": "getblockchaininfo", "params": []}', "http://localhost:18443", "-O", "-"]
      interval: 10s
      timeout: 5s
      retries: 10
    restart: unless-stopped
